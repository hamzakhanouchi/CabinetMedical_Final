@model IEnumerable<CabinetMedical.Models.RendezVous>
@{
    ViewBag.Title = "Tableau de Bord";
    string userRole = Session["UserRole"] != null ? Session["UserRole"].ToString() : "";
}

<div class="container-fluid">

    <div class="row mb-4">
        <div class="col-12">
            <div class="card text-white shadow border-0" style="background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); border-radius: 20px;">
                <div class="card-body p-4">
                    <h1 class="font-weight-bold">Bonjour, Dr. @Session["UserName"] 👋</h1>
                    <p class="lead mb-0" style="opacity: 0.9;">
                        @if (userRole == "Medecin")
                        {<text>Voici votre activité personnelle du jour.</text> }
                    else
                    { <text>Voici le résumé global du cabinet.</text>}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-0 shadow h-100 py-2 card-hover">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1" style="letter-spacing: 1px;">
                                @if (userRole == "Medecin")
                                {<text>Mes Patients</text> }
                            else
                            { <text>Total Patients</text>}
                            </div>
                            <div class="h1 mb-0 font-weight-bold text-gray-800">@ViewBag.NombrePatients</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-3x" style="color: #e3e6f0;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-0 shadow h-100 py-2 card-hover">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1" style="letter-spacing: 1px;">
                                @if (userRole == "Medecin")
                                {<text>Mes RDV Aujourd'hui</text> }
                            else
                            { <text>RDV Aujourd'hui</text>}
                            </div>
                            <div class="h1 mb-0 font-weight-bold text-gray-800">@ViewBag.RdvAujourdhui</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-check fa-3x" style="color: #e3e6f0;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* --- CES CARTES NE S'AFFICHENT QUE POUR ADMIN ET SECRÉTAIRE --- *@
        @if (userRole != "Medecin")
        {
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow h-100 py-2 card-hover">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1" style="letter-spacing: 1px;">Médecins</div>
                                <div class="h1 mb-0 font-weight-bold text-gray-800">@ViewBag.NombreMedecins</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-md fa-3x" style="color: #e3e6f0;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow h-100 py-2 card-hover">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1" style="letter-spacing: 1px;">Secrétariat</div>
                                <div class="h1 mb-0 font-weight-bold text-gray-800">@ViewBag.NombreSecretaires</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-headset fa-3x" style="color: #e3e6f0;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

    </div>

    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card shadow border-0" style="border-radius: 15px; overflow: hidden;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white border-bottom-0">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        @if (userRole == "Medecin")
                        {<text>Vos Prochains Rendez-vous</text> }
                    else
                    { <text>Planning Global</text>}
                    </h6>
                    <a href="@Url.Action("Index", "RendezVous")" class="btn btn-sm btn-primary rounded-pill px-3 shadow-sm">Tout voir</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light text-uppercase small font-weight-bold text-muted">
                                <tr>
                                    <th class="border-top-0 pl-4">Patient</th>
                                    <th class="border-top-0">Médecin</th>
                                    <th class="border-top-0">Heure</th>
                                    <th class="border-top-0">Motif</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td class="pl-4 font-weight-bold">
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle text-white d-flex justify-content-center align-items-center mr-3 shadow-sm"
                                                     style="width:40px; height:40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 1.1rem;">
                                                    @item.Patient.Nom.Substring(0, 1)
                                                </div>
                                                @item.Patient.Nom @item.Patient.Prenom
                                            </div>
                                        </td>
                                        <td>Dr. @item.Medecin.Nom</td>
                                        <td><span class="badge bg-light text-dark border font-weight-normal px-3 py-2">@item.DateHeure.ToString("HH:mm")</span></td>
                                        <td class="text-muted">@item.Motif</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="card shadow border-0 mb-4" style="border-radius: 15px;">
                <div class="card-header py-3 bg-white border-bottom-0">
                    <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-bolt mr-2"></i>Actions Rapides</h6>
                </div>
                <div class="card-body">

                    @if (userRole != "Medecin")
                    {
                        <a href="@Url.Action("Create", "Patients")" class="btn btn-primary rounded-pill btn-block mb-3 text-left py-3 shadow-sm" style="background: linear-gradient(to right, #4e73df, #224abe); border:none;">
                            <i class="fas fa-user-plus mr-3 ml-2"></i> Nouveau Patient
                        </a>
                        <a href="@Url.Action("Create", "RendezVous")" class="btn btn-success rounded-pill btn-block mb-3 text-left py-3 shadow-sm" style="background: linear-gradient(to right, #42e695, #3bb2b8); border:none;">
                            <i class="fas fa-calendar-plus mr-3 ml-2"></i> Nouveau Rendez-vous
                        </a>
                    }

                    <a href="@Url.Action("Create", "Consultations")" class="btn btn-info rounded-pill btn-block text-left py-3 shadow-sm" style="background: linear-gradient(to right, #6a11cb, #2575fc); border:none;">
                        <i class="fas fa-stethoscope mr-3 ml-2"></i> Nouvelle Consultation
                    </a>
                </div>
            </div>

            @if (userRole != "Medecin")
            {
                <div class="text-center d-none d-lg-block">
                    <img class="img-fluid" style="max-width: 80%; opacity: 0.9;" src="https://cdni.iconscout.com/illustration/premium/thumb/medical-team-illustration-download-in-svg-png-gif-file-formats--doctor-nurse-healthcare-staff-hospital-pack-people-illustrations-3843588.png?f=webp" alt="Medical Team">
                </div>
            }
        </div>
    </div>
</div>

<style>
    .card-hover {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }

    .btn-block {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 1rem;
        transition: transform 0.2s;
    }

        .btn-block:hover {
            transform: scale(1.02);
        }

    .table thead th {
        font-size: 0.85rem;
        letter-spacing: 1px;
    }

    .table td {
        font-size: 0.95rem;
    }
</style>