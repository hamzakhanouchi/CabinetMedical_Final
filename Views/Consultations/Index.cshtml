@model IEnumerable<CabinetMedical.Models.Consultation>

@{
    ViewBag.Title = "Historique des Consultations";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary"><i class="fa-solid fa-file-medical"></i> Dossier Médical</h2>
    <a href="@Url.Action("Index", "Patients")" class="btn btn-outline-secondary">
        <i class="fa-solid fa-arrow-left"></i> Retour aux Patients
    </a>
</div>

<p>
    @if (Session["UserRole"] != null && Session["UserRole"].ToString() == "Medecin")
    {
        if (ViewBag.PatientId != null)
        {
            <a href="@Url.Action("Create", new { idPatient = ViewBag.PatientId })" class="btn btn-primary shadow">
                <i class="fa-solid fa-user-doctor"></i> Nouvelle Consultation
            </a>
        }
        else
        {
            <a href="@Url.Action("Create")" class="btn btn-primary shadow">
                <i class="fa-solid fa-plus"></i> Nouvelle Consultation
            </a>
        }
    }
</p>

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-md-12">
            <div class="card border-left-primary shadow-sm mb-4">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="m-0 font-weight-bold text-primary">
                        <i class="fa-solid fa-calendar-days"></i> @item.DateConsultation.ToShortDateString()
                        <span class="text-dark" style="font-size:0.9em; margin-left:10px;">
                            - Patient : <strong>@item.Patient.Nom @item.Patient.Prenom</strong>
                        </span>
                    </h5>
                    <span class="badge bg-info text-white">Dr. @item.Medecin.Nom</span>
                </div>

                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <strong><i class="fa-solid fa-stethoscope text-danger"></i> Diagnostic :</strong>
                            <p class="text-danger fw-bold mt-1">@item.Diagnostic</p>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fa-solid fa-pills text-success"></i> Traitement :</strong>
                            <p class="mt-1">@item.Traitement</p>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fa-solid fa-note-sticky text-warning"></i> Observations :</strong>
                            <p class="text-muted mt-1">@item.Observations</p>
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-white text-end">
                    @if (Session["UserRole"] != null && Session["UserRole"].ToString() == "Medecin")
                    {
                        <a href="@Url.Action("Index", "Prescriptions", new { idConsultation = item.IdConsultation })" class="btn btn-warning btn-sm">
                            <i class="fa-solid fa-pills"></i> Gérer Médicaments
                        </a>
                    }

                   

                    <a href="@Url.Action("Details", new { id = item.IdConsultation })" class="btn btn-info btn-sm text-white">
                        <i class="fa-solid fa-eye"></i> Détails
                    </a>
                </div>
            </div>
        </div>
    }
</div>